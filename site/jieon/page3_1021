# pages/page3.py
import streamlit as st

def _local_safe_rerun():
    """
    í˜ì´ì§€ ëª¨ë“ˆì´ app.pyì˜ _safe_rerunë¥¼ ì§ì ‘ importí•˜ì§€ ëª»í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ
    ì—¬ê¸°ì—ì„œë„ í´ë°±ìœ¼ë¡œ rerun/experimental_rerunì„ í˜¸ì¶œí•˜ë„ë¡ êµ¬í˜„.
    """
    if hasattr(st, "rerun") and callable(getattr(st, "rerun")):
        st.rerun()
    elif hasattr(st, "experimental_rerun") and callable(getattr(st, "experimental_rerun")):
        st.experimental_rerun()
    else:
        raise RuntimeError("Streamlit rerun ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. st.rerun ë˜ëŠ” st.experimental_rerunì´ í•„ìš”í•©ë‹ˆë‹¤.")

def user_info_form():
    if 'user_info' not in st.session_state:
        st.session_state.user_info = None

    if st.session_state.user_info:
        st.success("ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!")
        st.subheader("ğŸ“Š ì…ë ¥ëœ ì •ë³´ ìš”ì•½")
        col1, col2, col3 = st.columns(3)
        col1.metric("ì„±ë³„", st.session_state.user_info.get('gender', "-"))
        col2.metric("í‚¤", f"{st.session_state.user_info.get('height', '-') } cm")
        col3.metric("ì£¼ ì‚¬ìš© ì†", st.session_state.user_info.get('dominant_hand', "-"))
        st.markdown("---")
        if st.button("ì •ë³´ ë‹¤ì‹œ ì…ë ¥í•˜ê¸°"):
            st.session_state.user_info = None
            try:
                # ìš°ì„  app.pyì˜ _safe_rerunê°€ ìˆìœ¼ë©´ ì‚¬ìš© ì‹œë„
                if "_safe_rerun" in globals():
                    _safe_rerun()  # if imported into same namespace
                else:
                    _local_safe_rerun()
            except Exception:
                # í´ë°±: ê°€ëŠ¥í•œ stì˜ rerun í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œ
                if hasattr(st, "rerun"):
                    st.rerun()
                elif hasattr(st, "experimental_rerun"):
                    st.experimental_rerun()
    else:
        with st.form(key='user_info_form'):
            st.subheader("ğŸ“„ ì‚¬ìš©ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
            col1, col2 = st.columns(2)
            with col1:
                gender = st.radio("ì„±ë³„", options=('ì—¬ì„±', 'ë‚¨ì„±'), horizontal=True)
            with col2:
                height = st.number_input("í‚¤ (ì‹ ì¥, cm)", min_value=100, max_value=250, value=165, step=1)
            dominant_hand = st.radio("ì£¼ ì‚¬ìš© ì†", options=('ì˜¤ë¥¸ì†', 'ì™¼ì†'), horizontal=True)
            submitted = st.form_submit_button('ì œì¶œí•˜ê¸°')
            if submitted:
                st.session_state.user_info = {
                    "gender": gender,
                    "height": height,
                    "dominant_hand": dominant_hand
                }
                try:
                    if "_safe_rerun" in globals():
                        _safe_rerun()
                    else:
                        _local_safe_rerun()
                except Exception:
                    if hasattr(st, "rerun"):
                        st.rerun()
                    elif hasattr(st, "experimental_rerun"):
                        st.experimental_rerun()
